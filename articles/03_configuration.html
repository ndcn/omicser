<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>3-Configuration • omicser</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="3-Configuration">
<meta property="og:description" content="omicser">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">omicser</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.0.9.2021-11-03</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/00_quickstart.html">0-Overview and Quickstart</a>
    </li>
    <li>
      <a href="../articles/01_installation.html">1-Installation</a>
    </li>
    <li>
      <a href="../articles/02_data_curation.html">2-Data Curation</a>
    </li>
    <li>
      <a href="../articles/03_configuration.html">3-Configuration</a>
    </li>
    <li>
      <a href="../articles/04_sharing.html">4-Launching and sharing</a>
    </li>
    <li>
      <a href="../articles/browsing.html">Browsing your data</a>
    </li>
    <li>
      <a href="../articles/multiple_databases.html">Adding multiple datasets</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/ndcn/omicser/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="03_configuration_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>3-Configuration</h1>
            
            <h4 class="date">10/26/2021</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/ndcn/omicser/blob/master/vignettes/03_configuration.Rmd"><code>vignettes/03_configuration.Rmd</code></a></small>
      <div class="hidden name"><code>03_configuration.Rmd</code></div>

    </div>

    
    
<p>In the last section, we formatted and configured our data to make it accessible to the browser. In this section, we’ll create two sets of configuration instructions: - <code>db_config.yml</code> - located with the database files, and specific to each database - <code>omicser_options.yml</code> - located in the run directory, provides top-level configuration and identifies the database(s) accessible for visualization in the browser</p>
<p>We’ll continue to refer to the <a href="https://github.com/ndcn/omicser/blob/main/examples/browse_pbmc3k.R">PBMC3k example script</a> as our example.</p>
<div id="database-configuration" class="section level2">
<h2 class="hasAnchor">
<a href="#database-configuration" class="anchor"></a>Database configuration</h2>
<p>Creating the configuration file for a database provides the basic instructions to the browser for how data will be represented to and manipulated by the viewers of the application while browsing. This involves defining the experimental factors as well as visualization parameters.</p>
<p>The example below matches the PBMC3k. Please see the <a href="https://github.com/ndcn/omicser/tree/main/examples"><code>examples/</code></a> for alternative configurations.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1"></a><span class="co"># differentials: the order here dictates the order in which they will appear in the browser</span></span>
<span id="cb1-2"><a href="#cb1-2"></a>conf_list &lt;-<span class="st"> </span><span class="kw">list</span>(</span>
<span id="cb1-3"><a href="#cb1-3"></a>  <span class="dt">x_obs =</span> <span class="kw">c</span>(<span class="st">"leiden"</span>),</span>
<span id="cb1-4"><a href="#cb1-4"></a>  <span class="co"># measures</span></span>
<span id="cb1-5"><a href="#cb1-5"></a>  <span class="dt">y_obs =</span>  <span class="kw">c</span>(<span class="st">'n_genes'</span>, <span class="st">'n_genes_by_counts'</span>, <span class="st">'total_counts'</span>, <span class="st">'total_counts_mt'</span>, <span class="st">'pct_counts_mt'</span>),</span>
<span id="cb1-6"><a href="#cb1-6"></a>  <span class="dt">obs_groupby =</span> <span class="kw">c</span>(<span class="st">"leiden"</span>),</span>
<span id="cb1-7"><a href="#cb1-7"></a>  <span class="dt">obs_subset =</span> <span class="kw">c</span>(<span class="st">"leiden"</span>),</span>
<span id="cb1-8"><a href="#cb1-8"></a></span>
<span id="cb1-9"><a href="#cb1-9"></a>  <span class="dt">x_var =</span> <span class="kw">c</span>(<span class="st">"decile"</span>,<span class="st">"highly_variable"</span>),</span>
<span id="cb1-10"><a href="#cb1-10"></a>  <span class="dt">y_var =</span> <span class="kw">c</span>( <span class="st">'n_cells'</span>, <span class="st">'mt'</span>, <span class="st">'n_cells_by_counts'</span>, <span class="st">'mean_counts'</span>,</span>
<span id="cb1-11"><a href="#cb1-11"></a>            <span class="st">'pct_dropout_by_counts'</span>, <span class="st">'total_counts'</span>,</span>
<span id="cb1-12"><a href="#cb1-12"></a>            <span class="st">'means'</span>, <span class="st">'dispersions'</span>, <span class="st">'dispersions_norm'</span>, <span class="st">'mean'</span>, <span class="st">'std'</span>),</span>
<span id="cb1-13"><a href="#cb1-13"></a></span>
<span id="cb1-14"><a href="#cb1-14"></a>  <span class="dt">var_groupby =</span> <span class="kw">c</span>(<span class="st">"decile"</span>,<span class="st">"highly_variable"</span>),</span>
<span id="cb1-15"><a href="#cb1-15"></a>  <span class="dt">var_subset =</span> <span class="kw">c</span>(<span class="st">"decile"</span>,<span class="st">"highly_variable"</span>),</span>
<span id="cb1-16"><a href="#cb1-16"></a></span>
<span id="cb1-17"><a href="#cb1-17"></a>  <span class="dt">diffs =</span> <span class="kw">list</span>(<span class="dt">diff_exp_comps =</span> <span class="kw">levels</span>(<span class="kw">factor</span>(diff_exp<span class="op">$</span>versus)),</span>
<span id="cb1-18"><a href="#cb1-18"></a>               <span class="dt">diff_exp_comp_type =</span>  <span class="kw">levels</span>(<span class="kw">factor</span>(diff_exp<span class="op">$</span>comp_type)), <span class="co">#i don't think we need this</span></span>
<span id="cb1-19"><a href="#cb1-19"></a>               <span class="dt">diff_exp_obs_name =</span>  <span class="kw">levels</span>(<span class="kw">factor</span>(diff_exp<span class="op">$</span>obs_name)),</span>
<span id="cb1-20"><a href="#cb1-20"></a>               <span class="dt">diff_exp_tests =</span>  <span class="kw">levels</span>(<span class="kw">factor</span>(diff_exp<span class="op">$</span>test_type))),</span>
<span id="cb1-21"><a href="#cb1-21"></a></span>
<span id="cb1-22"><a href="#cb1-22"></a>  <span class="dt">layers =</span> <span class="kw">c</span>(<span class="st">"X"</span>,<span class="st">"raw"</span>),</span>
<span id="cb1-23"><a href="#cb1-23"></a></span>
<span id="cb1-24"><a href="#cb1-24"></a>  <span class="co"># dimension reduction</span></span>
<span id="cb1-25"><a href="#cb1-25"></a>  <span class="dt">dimreds =</span> <span class="kw">list</span>(<span class="dt">obsm =</span> ad<span class="op">$</span><span class="kw">obsm_keys</span>(),</span>
<span id="cb1-26"><a href="#cb1-26"></a>                 <span class="dt">varm =</span> ad<span class="op">$</span><span class="kw">varm_keys</span>()),</span>
<span id="cb1-27"><a href="#cb1-27"></a></span>
<span id="cb1-28"><a href="#cb1-28"></a>  <span class="co"># setting defaults for ad$obs </span></span>
<span id="cb1-29"><a href="#cb1-29"></a>  <span class="dt">default_factors =</span> default_factors,</span>
<span id="cb1-30"><a href="#cb1-30"></a>  <span class="dt">target_omics =</span> target_omics,</span>
<span id="cb1-31"><a href="#cb1-31"></a>  <span class="dt">omic_details =</span> <span class="kw">c</span>(<span class="st">'gene_ids'</span>, <span class="st">'n_cells'</span>, <span class="st">'mt'</span>, <span class="st">'n_cells_by_counts'</span>,</span>
<span id="cb1-32"><a href="#cb1-32"></a>                   <span class="st">'mean_counts'</span>, <span class="st">'pct_dropout_by_counts'</span>, <span class="st">'total_counts'</span>,</span>
<span id="cb1-33"><a href="#cb1-33"></a>                   <span class="st">'highly_variable'</span>, <span class="st">'means'</span>, <span class="st">'dispersions'</span>,</span>
<span id="cb1-34"><a href="#cb1-34"></a>                   <span class="st">'dispersions_norm'</span>, <span class="st">'mean'</span>, <span class="st">'std'</span>, <span class="st">'var_rank'</span>, <span class="st">'decile'</span>))<span class="er">)</span></span>
<span id="cb1-35"><a href="#cb1-35"></a></span>
<span id="cb1-36"><a href="#cb1-36"></a><span class="co"># write db_config.yml to database directory</span></span>
<span id="cb1-37"><a href="#cb1-37"></a>configr<span class="op">::</span><span class="kw">write.config</span>(<span class="dt">config.dat =</span> conf_list, </span>
<span id="cb1-38"><a href="#cb1-38"></a>                      <span class="dt">file.path =</span> <span class="kw">file.path</span>(DS_ROOT_PATH, DB_NAME, <span class="st">"db_config.yml"</span>),</span>
<span id="cb1-39"><a href="#cb1-39"></a>                      <span class="dt">write.type =</span> <span class="st">"yaml"</span>, <span class="dt">indent =</span> <span class="dv">4</span>)</span></code></pre></div>
</div>
<div id="browser-configuration" class="section level2">
<h2 class="hasAnchor">
<a href="#browser-configuration" class="anchor"></a>Browser configuration</h2>
<p>Top-level configuration lets the browser know where the database can be found. The following code</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># define omicser options</span>
<span class="va">omicser_options</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>database_names <span class="op">=</span> <span class="va">DB_NAME</span>,
                        db_root_path <span class="op">=</span> <span class="va">DB_ROOT_PATH</span>,
                        conda_environment <span class="op">=</span> <span class="va">CONDA_ENV</span><span class="op">)</span>

<span class="co"># write omicser_options.yml to run directory</span>
<span class="fu">omicser</span><span class="fu">::</span><span class="fu"><a href="../reference/write_config.html">write_config</a></span><span class="op">(</span><span class="va">omicser_options</span>, in_path <span class="op">=</span> <span class="va">OMICSER_RUN_DIR</span><span class="op">)</span></code></pre></div>
<p>To configure a the browser for multiple databases, please see the <a href="multiple_databases.html">Visualizing multiple datasets</a> information.</p>
<p>We’re done preparing our data and configuration! The next step will be to <a href="04_sharing.html">launch the browser and prepare to share with collaborators</a>.</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Andy Henrie.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
